                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( LOADBLOCK              <10/25/86>141)                                         \ FORGET 1K from minimal system                                                 APPENDIX FORGET A3MARK CREATE A3MARK    MAIN     FORGET  3MARK CREATE  3MARK                                              270     LOAD \ BUFFERS                  145 149 THRU \ COPYBSM/SWAPBSM          271     LOAD \ MYRESET                  150 158 THRU \ graphic compiler       \ 159 179 THRU \ test graphic loads       180 185 THRU \ music compiler           190 194 THRU \ text compiler            200 209 THRU \ "code" compiler          210 219 THRU \ !FILE                    159     LOAD \ TD                       142     LOAD \ TC                                                             CR ." SAVE TO COMPILER DISK!" CR                                                                                                                                                               ( FAH  )                                                                 (                        <10/23/86>142)                                         : TC                                      TESTCODE ;                                                                    : T2                                      ' TESTCODE 2+ >R ;                                                            : R2                                      SWAP-BSM RUNCODE                        SWAP-BSM 1HG ;                                                                : RC HGR R2 ;                                                                   : 2RC                                     HGR 2RUNCODE ;                                                                : 2GETF                                   2@FILE ;                                                                                                                                                                                                                             ( FAH  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( C@AUX-BSM              <10/ 7/86>145)                                         HEX \ fetch a byte from auxillay bsm    CODE C@AUX-BSM ( A -- v )                 BOT LDA, TAY,       \ get address       BOT 1+ LDA,                             C009 STA,           \ aux ZP/STK/BSM    F1 STA, F0 STY,     \ set adress        # 0 LDY, F0 )Y LDA, \ get the word      C008 STA,           \ main ZP/STK/BSM   BOT STA, 0 # LDA,                       BOT 1+ STA,                             NEXT JMP,                             C;                                      DECIMAL                                                                                                                                                                                                                                                                                                                                                                                                ( FAH  )                                                                 ( copypage               <10/ 7/86>146)                                         \ copy page X to aux bsm (D0-FF)        \ A,Y destroyed                         HEX CODE copypage                         C009 STA,           \ aux ZP/STK/BSM    0 # LDA,                                F1 STX, F0 STA,     \ set aux zp ptr    C008 STA,           \ main ZP/STK/BSM   F1 STX, F0 STA,     \ set main zp ptr   # 0 LDY,            \ loop counter      BEGIN,                                   C008 STA, F0 )Y LDA, \ read main        C009 STA, F0 )Y STA, \ store aux        INY, 0=                                UNTIL,                                  C008 STA,           \ main ZP/STK/BSM   RTS, C;                               DECIMAL                                                                                                                                                                                                                                ( FAH  )                                                                 ( COPY-BSM               < 9/15/86>147) \ copy main BSM to auxillary            \ destroyes 240-241 (N,N+1)  in both    \ main and auxillary memory             \ leaves with main bank 1 BSM active                                            HEX CODE COPY-BSM XSAVE STX,              C08B LDA, C08B LDA, \ r/w BSM bank 2    # D0 LDX,           \ starting page     BEGIN, ' copypage JSR,                   INX, # E0 CPX, 0= UNTIL,               C083 LDA, C083 LDA, \ r/w BSM bank 1    # D0 LDX,           \ starting page     BEGIN, ' copypage JSR,                   INX, # 00 CPX, 0= UNTIL,               XSAVE LDX, NEXT JMP, C;                                                       CODE COPY-ZP                              XSAVE STX,                              # 00 LDX, ' copypage JSR,               INX, ' copypage JSR,                    XSAVE LDX, NEXT JMP, C;               DECIMAL                                                                ( FAH  )                                                                 ( swappage               <10/ 7/86>148)                                         \ swap page X between aux/main BSM      \ A,Y destroyed                         HEX CODE swappage                         C009 STA,           \ aux ZP/STK/BSM    0 # LDA,                                F1 STX, F0 STA,     \ set aux zp ptr    C008 STA,           \ main ZP/STK/BSM   F1 STX, F0 STA,     \ set main zp ptr   # 0 LDY,            \ loop counter      BEGIN, C008 STA,                         F0 )Y LDA, TAX,    \ read main          C009 STA, F0 )Y LDA, \ read aux         C008 STA, F0 )Y STA, \ store main       C009 STA, TXA,                          F0 )Y STA,         \ store aux          INY, 0=                                UNTIL,                                  C008 STA,           \ main ZP/STK/BSM   F1 LDX,             \ restore X         RTS, C;                               DECIMAL                                                                ( FAH  )                                                                 ( SWAP-BSM               <10/ 7/86>149) \ SWAP main and auxillary BSM           \ destroyes 240-241 (N,N+1)  in both    \ main and auxillary memory             \ leaves with main bank 1 BSM active                                            HEX CODE SWAP-BSM                         XSAVE STX,                            \ copy bank 1 BSM                         C08B LDA, C08B LDA, \ r/w BSM bank 2    # D0 LDX,           \ starting page     BEGIN, ' swappage JSR,                   INX, # E0 CPX, 0= UNTIL,             \ copy bank 2 and remainder of BSM        C083 LDA, C083 LDA, \ r/w BSM bank 1    # D0 LDX,           \ starting page     BEGIN, ' swappage JSR,                   INX, # 00 CPX, 0= UNTIL,               XSAVE LDX,                              NEXT JMP,                             C; DECIMAL                                                                                                                                             ( FAH  )                                                                 ( READFIG notes          < 9/15/86>150)                                         EXIT                                                                            FINDFIG searchs for the fill named      in the input stream and returns         the length of the image in bytes        if also sts the starting block number   for READFIG                                                                     READFIG will read in the last found     figure to the address it is passed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( FAH  )                                                                 ( READFIG vars           <10/16/86>151)                                                                                 \ address of the first memory           \ location that is available for        \ graphic storage                       0 CONSTANT DSTART                                                                                                       VARIABLE FSTART \ start blk# for fig    VARIABLE FLEN   \ length in bytes                                               : WAITBL                                  CR ." Press SPACE to continue" CR       BEGIN KEY BL = UNTIL CR ;             : GDISK                                   CR CR ." Insert graphics disk in A"     WAITBL ;                              : PDISK                                   CR CR ." Insert program disk in A"      WAITBL ;                                                                                                                                             ( FAH  )                                                                 ( $=                     <10/ 3/86>152)                                                                                 : $= \ ADR1 ADR2 - T/F;                   OVER C@ OVER C@ \ A1 A2 L1 L2           OVER =                                  IF 0                                     DO 1+ SWAP 1+ SWAP                       OVER C@ OVER C@ = NOT                   IF LEAVE THEN                          LOOP                                    C@ SWAP C@ =                           ELSE DROP DDROP 0                       THEN ;                                                                                                                                                                                                                                                                                                                                                                                                                                       ( FAH  )                                                                 ( FINDFIG"               <10/ 3/86>153)                                         \ searchs for graphic file on drive A                                           : FINDFIG" \ -- N/0;                      34 WORD                                 0 BLOCK 36 + \ start of first name      BEGIN DUP C@                            WHILE \ ADR ADR --                       DDUP $=                                 IF 13 + C@ FSTART ! DROP                 FSTART @ BLOCK                          DUP @ 7 /                               SWAP 2+ C@ * 4 + DUP FLEN ! EXIT       THEN                                    26 +                                   REPEAT                                  1 ABORT" not on this disk!"           ;                                                                                                                                                                                                                                      ( FAH  )                                                                 ( READFIG                <10/ 7/86>154)                                         \ read the last figure found by         \ FINDFIG" to address passed            \ -- uses graphics page as a buffer     \ -- does not use block                 VARIABLE RBLK                           : READFIG ( adr -- )                      DEPTH 1 < ABORT" NUM?"                  FSTART @ RBLK !                         FLEN @ \ ADR CNT                        BEGIN DUP 1024 >                        WHILE >R                                  DUP RBLK @ 1 R/W                        1024 + R> 1024 - 1 RBLK +!            REPEAT                                  ?DUP                                    IF >R 8192 RBLK @ 1 R/W                    8192 SWAP R> CMOVE                   ELSE DROP THEN                        ;                                                                                                                                                      ( FAH  )                                                                 ( MARK-INIT MARK-PIC"    <10/ 7/86>155) VARIABLE GFILE#                         VARIABLE #PICS                          CREATE PSTART 30 3 * ALLOT              \ START C, LEN ,                                                                : MARKINIT ( N -- )                       ?NUM GFILE# ! 0 #PICS ! ;                                                     : MPIC"                                   #PICS @ 30 < NOT                        ABORT" TOO MANY PICTURES"               #PICS @ 3 * PSTART +                    FINDFIG"                                OVER 1+ !                               FSTART @ SWAP C!                        1 #PICS +! ;                                                                  : MARKDONE                                0 #PICS @ 0                             DO I 3 * PSTART + 1+ @ +                LOOP CR . ." bytes total" CR ;                                                                               ( FAH  )                                                                 ( MEMORY LAYOUT          <10/14/86>156) EXIT ----------------------------- EXIT                                         Program Files are loaded starting at    the top of memory and progress down     skiping over the I/O area.                                                      FFED-FFEF: Filler                       FFEB-FFEC: low adr used in BSM          FFEA     : "File id #"                  FFE8-FFE9: code start addr              FFE6-FFE7: text start addr              FFE4-FFE5: Music start addr             FFE2-FFE3: Graphics start addr          FFE0-FFE1: next free addr                                                       \ each area has a header at the top     AD+4-AD+5: adr of item 2                AD+2-AD+3: adr of item 1                AD+0-AD+1: next free addr below                                                                                                                                                                ( FAH  )                                                                 ( BUFMOVE BUFRESET       <10/20/86>157)                                         : BUFMOVE ( ADR -- )                       DEPTH 1 < ABORT" ADR BUFMOVE"           DUP ' LIMIT ! #BUFF 1028 * -            DUP ' FIRST ! DUP USE ! PREV !          EMPTY-BUFFERS ;                      : BUFRESET \ move to normal location      46592 BUFMOVE ;                       VARIABLE LSA HEX                        \ copy len bytest to dest return addr   \ that was actually saved at            : !UPPER ( SRC DEST LEN -- ADR' )          >R DUP C000 - 1000 U< \ in i/o page?    IF DROP B600 R@ - LSA @ FFEB ! THEN     SWAP OVER R> CMOVE DUP LSA !            10 BASE ! DUP U. DECIMAL             ;                                       \ move disk buffers if needed           : SETBUF ( ADR -- )                       DUP B600 U<                             IF 20 - BUFMOVE ELSE DROP THEN        ; DECIMAL                                                              ( FAH  )                                                                 ( GETPICS                <10/15/86>158) HEX \ reads all pictures into memory    : GETPICS                                 FORGET-SYS SWAP-BSM FLUSH               FFE0 10 0 FILL GFILE# @ FFEA C!         FFE0 #PICS @ 1+ 2* -                    DUP FFE2 ! #PICS @ 0                    DO PSTART I 3 * + C@ FSTART !            \ compute load address for this         PSTART I 3 * + 1+ @ ( Len )             DUP FLEN ! - \ adr flen -- load_adr     PAD READFIG                             PAD SWAP FLEN @ !UPPER                  DUP FFE2 @ I 1+ 2* + ! \ save start    LOOP                                    DUP FFE2 @ ! \ store next avail         DUP FFE0 ! \ in master rec too          CR ." NEXT FREE=" 10 BASE !             DUP U. DECIMAL CR                       10 - SETBUF                             SWAP-BSM ; DECIMAL                                                                                                                                   ( FAH  )                                                                 ( TEST DRAW              <10/ 7/86>159)                                         HEX                                     : <TD>  ( X Y N -- )                      1+ 2*                                   FFE2 @ \ graphics start                 + @ [ GFIG ] LITERAL !                  FY ! FX !                               [ drawfig ] LITERAL CALL              ;                                       : TD                                      DEPTH 3 < ABORT" X Y N TD"              FORGET-SYS SWAP-BSM <TD> SWAP-BSM     ;                                       DECIMAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( TEST LOAD OPEN 2       <10/ 7/86>160)                                         2 MARKINIT                                                                        MPIC" HEAD"                             MPIC" TCAN1"                            MPIC" BAG1"                             MPIC" BREATH1"                          MPIC" TCAN2"                            MPIC" BAG2"                             MPIC" BREATH2"                          MPIC" WIN"                              MPIC" BIGBAG1"                          MPIC" BIGTREE"                          MPIC" BTCANA1"                          MPIC" BTCANA2"                          MPIC" BTCANB1"                          MPIC" BTCANB2"                                                                MARKDONE                                \ 18856 TOTAL 9654                                                                                                                                                                                                              ( TD2                    <10/ 7/86>161) : TD2                                     65514 C@AUX-BSM 2 = NOT                 ABORT" WRONG FILE LOADED"               HGR SWAP-BSM 0 0 0 <TD>                 168 0 1 <TD> 196 96 2 <TD>              0 96 3 <TD> 1000 0                      DO 168 0 I 2 MOD 1 =                     IF 4 ELSE 1 THEN <TD>                   I 6 MOD DUP 3 =                         IF 0 96 3 <TD> THEN                     0= IF 0 96 6 <TD> THEN                  ?TERMINAL IF LEAVE THEN                LOOP                                    5 0 DO 196 96 2 <TD> 196 96 5 <TD>      LOOP [ cls ] LITERAL CALL               0 0 7 <TD> 196 8 9 <TD>                 14 128 8 <TD> 1000 0                    DO 266 16 10 <TD> 238 120 12 <TD>        300 0 DO NOOP LOOP                      266 16 11 <TD> 238 120 13 <TD>          300 0 DO NOOP LOOP                      ?TERMINAL IF LEAVE THEN                LOOP SWAP-BSM ;                                                                                       ( TEST LOAD OPEN 1       <10/ 8/86>162)                                         1 MARKINIT                                                                        MPIC" WCAN1"                            MPIC" WCAN2"                            MPIC" WTL"                              MPIC" WR"                               MPIC" WBM"                              MPIC" WTM"                              MPIC" SPARK"                            MPIC" CHEER"                                                                  MARKDONE                                                                        \ 8204 TOTAL                            \ DFC2                                                                                                                                                                                                                                                                                                                                                                                          ( TD1                    <10/ 7/86>163)                                                                                 : TD1                                     65514 C@AUX-BSM 1 = NOT                 ABORT" WRONG FILE LOADED"               HGR SWAP-BSM                            0 72 0 <TD> 0 0 2 <TD>                  70 0 5 <TD> 196 0 3 <TD>                70 152 4 <TD>                                                                   1000 0                                  DO 0 72 I 2 MOD 1 = <TD>                 ?TERMINAL IF LEAVE THEN                LOOP                                                                            168 8 6 <TD>                            70 0 5 <TD>                             SWAP-BSM                              ;                                                                                                                                                                                                                                                                       ( TEST LOAD OPEN 3       <10/ 7/86>164)                                         3 MARKINIT                                                                        MPIC" WIN"                              MPIC" BIGBAG1"                          MPIC" BIGBAG2"                          MPIC" BIGBAG3"                          MPIC" BIGTREE"                          MPIC" BTCANA1"                          MPIC" BTCANA2"                          MPIC" BTCANB1"                          MPIC" BTCANB2"                          MPIC" PEEK"                                                                   MARKDONE                                \ 11136 TOTAL D44A                                                                                                                                                                                                                                                                                                                                                                              ( TD3                    <10/ 8/86>165)                                         : TD3                                     65514 C@AUX-BSM 3 = NOT                 ABORT" WRONG FILE LOADED"               HGR SWAP-BSM                            0 0 0 <TD> 196 8 4 <TD>                 5 0                                     DO 14 128 1 <TD>                          14 128 2 <TD>                           14 128 3 <TD>                         LOOP                                    14 128 1 <TD>                           1000 0 DO NOOP LOOP                     42 96 9 <TD>                            SWAP-BSM                              ;                                                                                                                                                                                                                                                                                                                                                                                               ( TEST LOAD MENU         <10/ 9/86>166)                                         4 MARKINIT                                                                        MPIC" WIN"                              MPIC" BIGBAG1"                          MPIC" BIGTREE"                          MPIC" BTCANA1"                          MPIC" BTCANA2"                          MPIC" BTCANB1"                          MPIC" BTCANB2"                          MPIC" BEND"                             MPIC" ELF1"                             MPIC" ELF2"                             MPIC" DISK"                             MPIC" EYES"                                                                   MARKDONE                                \ 15950 TOTAL A034                                                                                                                                                                                                                     ( FAH  )                                                                 ( TD4                    <10/ 8/86>165)                                         : TD4W                                    1000 0 DO NOOP LOOP ;                 : TD4                                     65514 C@AUX-BSM 4 = NOT                 ABORT" WRONG FILE LOADED"               HGR SWAP-BSM                            0 0 0 <TD> 14 128 1 <TD>                196 8 2 <TD> TD4W TD4W TD4W             42 72 7 <TD> TD4W                       42 48 9 <TD>                            142 236 C! 10 0                         DO 42 48 I 2 MOD 8 + <TD>               LOOP                                    192 236 C! TD4W TD4W                    70 88 11 <TD>                           SWAP-BSM                              ;                                                                                                                                                                                                                                                                                                               ( TEST LOAD MENU         <10/ 9/86>168)                                         5 MARKINIT                                                                        MPIC" COMPUTER"                         MPIC" BRANCH"                           MPIC" JUMP1B"                           MPIC" JUMP2B"                           MPIC" LAND1"                            MPIC" STANDB"                           MPIC" CAR"                              MPIC" BEAR"                             MPIC" BOAT"                             MPIC" DOLL"                             MPIC" KITE"                             MPIC" BUS"                              MPIC" TRUCK"                            MPIC" PLANE"                                                                  MARKDONE                                \ 9720 TOTAL D9CA                                                                                                                                                                                                               ( TD5                    <10/ 9/86>169)                                         : TD5                                     65514 C@AUX-BSM 5 = NOT                 ABORT" WRONG FILE LOADED"               HGR SWAP-BSM                            126 0 0 <TD> 70 0 1 <TD>                4000 0 DO NOOP LOOP                     0 100 2 <TD> TD4W                       0 100 3 <TD> TD4W                       0 110 4 <TD> TD4W                       12 118 5 <TD> TD4W                      24 233 C! 34 234 C!                     14 6                                    DO 270 100                               DO I 48 J <TD> 2 +LOOP                 LOOP                                    SWAP-BSM                                0 233 C! 40 234 C!                    ;                                                                                                                                                                                                                                                                       ( TEST LOAD BEARS        <10/ 7/86>170)                                         6 MARKINIT                                                                        MPIC" F1"         MPIC" F2"             MPIC" F3"         MPIC" F4"             MPIC" F5"         MPIC" F6"             MPIC" F7"         MPIC" F8"             MPIC" F9"         MPIC" F10"            MPIC" F11"        MPIC" F12"            MPIC" F13"        MPIC" F14"            MPIC" F15"        MPIC" F16"            MPIC" F12B"       MPIC" F13B"           MPIC" BRANCHES"                                                               MARKDONE                                \ 15460 TOTAL A61C                                                                                                                                                                                                                                                                                                     ( FAH  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( TEST LOAD ELVES PART 1 <10/14/86>172)                                         7 MARKINIT                              MPIC" BRANCHES"                         MPIC" BOX1"       MPIC" BOX2"           MPIC" BOX3"       MPIC" BOX4"           MPIC" BOX5"       MPIC" BOX6"           MPIC" BOX7"       MPIC" BOX8"           MPIC" BOX8ELF"                          MPIC" FLYA1"      MPIC" FLYA2"          MPIC" LANDA"      MPIC" STANDA"         MPIC" FLYB1"      MPIC" FLYB2"          MPIC" LANDB"      MPIC" STANDB"         MPIC" FLIPB"      MPIC" STANDB2"                                                MARKDONE                                \ 16224 TOTAL A3D4                                                                                                                                                                                                                                                                                                     ( FAH  )                                                                 ( TD7 prims              <10/12/86>173)                                         : VA S' valt CALL ;                     : DA S' dalt CALL ;                     : VDA VA DA ;                           : CV S' copyv CALL ;                    HEX : EF ( X Y N -- )                     \ address of graphics figure            1+ 2* FFE2 @ + @ >R                     DDUP LY1 ! LX1 ! R@ 2+ @ + LY2 !        R> @ + LX2 ! S' bbar CALL ; DECIMAL                                           : TD7B                                    <TD>  700 0 DO NOOP LOOP ;            CREATE TDA 12 ALLOT                     : TD7C \ erase last one                   TDA DPAGE @ IF 6 + THEN                 DUP @ -1 = IF DROP                      ELSE >R R@ @ R@ 2+ @ R> 4 + @ EF THEN   TDA VPAGE @ 0= IF 6 + THEN >R           3 PICK R@ ! OVER R@ 2+ ! DUP            R> 4 + ! <TD> VDA                      500 0 DO NOOP LOOP ;                                                                                                                           ( TD7                    <10/12/86>174) : TD7                                     65514 C@AUX-BSM 7 = NOT                 ABORT" WRONG FILE LOADED"               HGR SWAP-BSM                              0   0  0 TD7B   0  78  1 TD7B           0  86  2 TD7B   0  78  3 TD7B           0  72  4 TD7B   0  70  5 TD7B           0 110  6 TD7B   0 126  7 TD7B           0  86  8 TD7B   14 86  9 TD7B           0  86  8 <TD>                         TDA 12 255 FILL CV                       84  40 10 TD7C 126  70 11 TD7C         140 110 12 TD7C 140 112 13 TD7C           S' dvpage CALL                          0  86  8 TD7B   14 86  9 TD7B           0  86  8 <TD>                         TDA 12 255 FILL CV                       92  32 14 TD7C 148  36 15 TD7C         190  70 15 TD7C 210 102 16 TD7C         210 112 17 TD7C 210  96 18 TD7C         210  90 19 TD7C                         SWAP-BSM ;                                                                                                                                    ( TEST LOAD ELVES PART 2 <10/12/86>175)                                         8 MARKINIT                                                                      MPIC" DANCE1"     MPIC" DANCE2"         MPIC" DANCE3"     MPIC" DANCE4"         MPIC" CLAP1"      MPIC" CLAP2"          MPIC" DUO1"       MPIC" DUO2"           MPIC" SPIN1"      MPIC" SPIN2"          MPIC" SPIN3"      MPIC" SPIN4"          MPIC" SPIN5"      MPIC" SPIN6"          MPIC" STANDA"     MPIC" STANDB2"                                                MARKDONE                                \ 13780 TOTAL A3D4                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( TD8                    <10/12/86>176) : TD8B                                    <TD> 1000 0 DO LOOP ;                 VARIABLE GN                             : TD8                                     65514 C@AUX-BSM 8 = NOT                 ABORT" WRONG FILE LOADED"               HGR SWAP-BSM                            140 112 14 <TD> 210 90 15 <TD>          10 0                                    DO 140 112 0 TD8B 140 112 3 TD8B           210 114 4 <TD>                          140 112 1 TD8B 140 112 2 TD8B           210 114 5 <TD> LOOP                  140 112 6 TD8B 140 112 7 TD8B           8 GN ! 280 126                          DO I 112 GN @ <TD>                       GN @ 1+ DUP 13 >                        IF DROP 8 THEN GN !                     4 +LOOP                                SWAP-BSM ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( MUSIC COMPILER NOTES   <10/13/86>180) EXIT ----------------------------- EXIT                                         The music compiler simply compiles the  music at pad then adds it to the file   graphic file that is already loaded     in memory                                                                       The sequence is:                                                                  m MUSICINIT   m is max # of tunes       n STARTTUNE   n start tune n (1-m)        ENDTUNE     ends tune                   TEST        play tune just loaded                   (does not have to be                     stored first)              STORETUNE   store last tune in                      upper RAM                                                                                                                                                                                                                                                                                                                               ( MUSIC COMPILER         <10/13/86>181)                                         0 CONSTANT MUSADR                       0 CONSTANT NOFF \ notes offset          1 CONSTANT NDEL \ delay between notes   5 1 DCONSTANT MMULT \ period multiplier                                         : NDEF ( -- set default conditions )      0 ' NOFF ! 1 ' NDEL !                   5 1 ' MMULT D! ;                                                              : M, ( N -- )                              MUSADR C! 1 ' MUSADR +! ;                                                    : RNUM BL WORD NUMBER DROP ;            : NOTE                                     CREATE C,                               DOES> C@ RNUM RNUM                      >R 1- 12 * + 2 * NOFF + M,              R> MMULT */ M, NDEL                     IF 0 M, NDEL M,                         THEN ;                                                                                                      ( FAH  )                                                                 ( NOTES                  <10/13/86>182)                                          1 NOTE Ab                               2 NOTE A                                3 NOTE Bb                               4 NOTE B                                5 NOTE C                                6 NOTE Db                               7 NOTE D                                8 NOTE Eb                               9 NOTE E                               10 NOTE F                               11 NOTE Gb                              12 NOTE G                                                                                                                                                                                                                                                                                                                                                                                                                                      ( FAH  )                                                                 ( PLAY MUSIC             <10/13/86>183)                                         CODE play                                 XSAVE STX,                              BEGIN, DELEND 80 - JSR,   \ 172          music JSR,               \ 19           music LDA, # 96 CMP, 0=  \ 4 2         UNTIL,                    \ 3           XSAVE LDX,                              NEXT JMP, C;                                                                  : PLAY ( ADR -- )                         S' >MUS ! 1 S' MPER C!                  3 S' MCNT C! 198 S' music C!            10 MDLP C! 1 S' MDUR C! play ;                                                HEX                                     : PLAYN ( N -- )                          SWAP-BSM 2* FFE4 @ + @                  PLAY SWAP-BSM ;                       DECIMAL                                                                                                                                                ( FAH  )                                                                 ( MUSICINIT              <10/14/86>184) VARIABLE TUNE#                          HEX 31 TO WIDTH                         : MUSICINIT ( N -- # of tunes )            ?NUM SWAP-BSM 1+ 2*                     FFE2 @ @ SWAP - DUP FFE4 ! FFE0 !       SWAP-BSM ;                           : STARTTUNE ( m -- ; m=1 to N )            ?NUM TUNE# ! PAD ' MUSADR ! ;        : ENDTUNE 0 M, 0FF M, ;                 : STORETUNE                                FLUSH SWAP-BSM TUNE# @ 1- ?DUP          IF 2* FFE4 @ + @                        ELSE FFE4 @ THEN                        MUSADR PAD - DUP >R -                   PAD SWAP R> !UPPER                      DUP TUNE# @ 2* FFE4 @ + !               DUP FFE4 @ ! DUP FFE0 !                 DUP SETBUF SWAP-BSM ;                                                        : TEST PAD PLAY ;                       5 TO WIDTH                              DECIMAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( TEXT NOTES             <10/14/86>190) EXIT ----------------------------- EXIT                                         Text is setup like all other areas      in the data area.                                                               To load text simply create an :$        array that has all your messages        then pass the name of that array        to STORETEXT and everything else        will be done automattically                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( FAH  )                                                                 ( TEXTINIT ENDTEXT M"    <10/13/86>191)                                         31 TO WIDTH HEX                         : STORETEXT ( ADR )                       ?NUM SWAP-BSM >R                        R@ @ 1+ 2* FFE4 @ @ SWAP -              DUP FFE6 ! FFE0 !                       R@ 2+ R> @ 1+ 1                         DO DUP                                   FFE0 @ OVER C@ 1+ - ( store adr )       3 PICK C@ 1+ !UPPER ( check boundry)    DUP I 2* FFE6 @ + !  ( !ptr)            DUP FFE6 @ ! FFE0 !                     COUNT +                                LOOP                                    DROP FFE0 @ SETBUF                      SWAP-BSM ;                            DECIMAL 5 TO WIDTH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      (                        <10/14/86>195)                                                                                 :$ T                                      .$ This is message 1$                   .$ This is message 2$                   .$ This is message 3$                   .$ This is message 4$                 ;$                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( FAH  )                                                                 ( TT                     <10/13/86>196)                                         HEX                                     : TT ( N -- )                             SWAP-BSM                                2* FFE6 @ + @ COUNT TYPE                SWAP-BSM                              ;                                       DECIMAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( FAH  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( CODE NOTES             <10/16/86>200)                                         EXIT ----------------------------- EXIT                                         Code is simply tokenized bytes          followed by any data that is required   for the code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( FAH  )                                                                 ( CODE COMPILER VARIABLES<10/15/86>201)                                                                                 0 CONSTANT CODADR                                                               VARIABLE CODE#                                                                  VARIABLE STARTDEPTH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( FAH  )                                                                 ( PRIMITIVES             <10/15/86>202)                                         : GETNUM ( -- N )                         BL WORD NUMBER DROP ;                                                         : P, ( N -- )                             CODADR ! 2 ' CODADR +! ;                                                      : PC, ( N -- )                            CODADR C! 1 ' CODADR +! ;                                                     : GETNUM, ( -- )                          GETNUM P, ;                                                                   : STACK-OK? ( -- )                        DEPTH STARTDEPTH @ = NOT                ABORT" STACK DEPTH CHANGE" ;                                                                                                                                                                                                                                                                                         ( FAH  )                                                                 ( CODEINIT STARTCODE ENDC<10/19/86>203)                                         31 TO WIDTH HEX                                                                 : CODEINIT ( N -- # of code segs )         ?NUM SWAP-BSM 1+ 2*                     FFE6 @ @ SWAP - DUP FFE8 ! FFE0 !       SWAP-BSM ;                                                                   : STARTCODE ( m -- ; m=1 to N )            ?NUM CODE# ! PAD ' CODADR !             DEPTH STARTDEPTH ! ;                                                         : ENDCODE ( -- )                           0 P, ;                                                                       : TESTCODE                                 HGR SWAP-BSM PAD S' >PRO !              S' runcode CALL SWAP-BSM                1HG ;                                                                        DECIMAL                                                                                                        ( FAH  )                                                                 ( STORECODE              <10/24/86>204)                                         31 TO WIDTH HEX                                                                 : STORECODE                                STACK-OK?                               FLUSH SWAP-BSM CODE# @ 1- ?DUP          IF 2* FFE8 @ + @                        ELSE FFE8 @ THEN                        CODADR PAD - DUP >R -                   PAD SWAP R> !UPPER                      DUP CODE# @ 2* FFE8 @ + !               DUP FFE8 @ ! DUP FFE0 !                 SETBUF SWAP-BSM                      ;                                                                               DECIMAL                                                                                                                                                                                                                                                                                                                ( FAH  )                                                                 ( B: WY: XYB: XYXY:      <10/17/86>205)                                         : B:                                       ?NUM CREATE C,                          DOES> C@ PC, GETNUM PC, ;                                                    : XY:                                      ?NUM CREATE C,                          DOES> C@ PC, GETNUM, GETNUM, ;                                               : XYB:                                     ?NUM CREATE C,                          DOES> C@ PC, GETNUM, GETNUM,             GETNUM PC, ;                                                                : XYXY:                                    ?NUM CREATE C,                          DOES> C@ PC, GETNUM, GETNUM,             GETNUM, GETNUM, ;                                                                                                                                                                                                                  ( FAH  )                                                                 ( XYBB: NO:              <10/17/86>206)                                                                                 : XXYBB:                                   ?NUM CREATE C,                          DOES> C@ PC, GETNUM, GETNUM,             GETNUM, GETNUM PC, GETNUM PC, ;                                             : NO:                                      ?NUM CREATE C,                          DOES> C@ PC, ;                                                               : W:                                       ?NUM CREATE C,                          DOES> C@ PC, GETNUM, ;                                                                                                                                                                                                                                                                                                                                                                              ( FAH  )                                                                 ( ROUTINES               <10/17/86>207)                                          1   XYB: GRAPHIC \ draw graphic         2   XYB: MESSAGE \ print message        3     B: MUSIC   \ start tune           4  XYXY: WBAR    \ white bar            5  XYXY: BBAR    \ black bar            6  XYXY: WBUB    \ white bubble         7  XYXY: BBUB    \ black bubble         8 XXYBB: BLHOOK \ black left hook       9 XXYBB: BRHOOK \ black right hook     10 XXYBB: WLHOOK \ while left hook      11 XXYBB: WRHOOK \ white right hook     12    NO: VDINIT  \ draw view page 1    13    NO: COPYV   \ copy view, set draw 14    NO: VDALT   \ view alt, draw alt  15    NO: VDPAGE  \ view draw page      16    NO: DVPAGE  \ draw view page      17    NO: TNORM   \ text white on black 18    NO: TINV    \ text black on white 19     W: WAIT    \ wait n mu cycles                                                                                                                   ( FAH  )                                                                 ( ROUTINES CONT.         <10/23/86>208)                                                                                 20    NO: CLEAR   \ clear draw screen   21    NO: VALT    \ view alternate      22    NO: DALT    \ draw alternate      23  XYXY: SETWIN  \ set draw window                       \ xvals are bytes     24    NO: FULLWIN \ set full window     25     W: 1START  \ start of loop 1     26    NO: 1LOOP   \ loop 1 end          27   XYB: DGRAPHIC \ draw bank 2 graphc 28   XYB: 2GRAPHIC \ switch to bank 2             \ draw then switch back       29     B: REDRAW   \ draw n at cur pos  30     B: ADDFX    \ add N to FX        31    NO: CLRBEAR  \ spec clr for bear  32    NO: CLRELF   \ spec clr for elves                                                                                                                                                                                                                                        ( FAH  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( WRITE NOTES            <10/16/86>210) EXIT ----------------------------- EXIT                                         sector 12 is used to hold index         information that determines where the   data files are located on disk.                                                 format is:                                                                      each entry in the table is a word that  specifies the starting block number     (word) and a length byte.  There are    two entries for each file, the first    loades the portion in BSM and the       second loads the half in main memory    (if the file fits in the BSM then       the second entry will be zeros)                                                                                                                                                                                                                                                                                        ( FAH  )                                                                 ( RWSEC#                 <10/20/86>211) EXIT --- LOADED BY SYSTEM DISK --- EXIT                                         \ sectors are numbered 0-639            : RWSEC# ( ADR SEC# R/W N -- )             >R >R >R 6 0                            R> 16 /MOD R> R> RWTS                ;                                                                               \ AD SL DR SE TR R/W N                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( FAH  )                                                                 ( GETSEC#                <10/16/86>212)                                         VARIABLE FILE# ( 0-? )                  \ assumes directory block is read       \ in a PAD and FILE# is the number      \ of this file, return last sector      \ used by previous file, or             \ the end of disk is file# 0            : GETSEC# ( -- SEC# )                     FILE# @ ?DUP \ if not first file        IF 1- 6 * PAD + \ last file dir          DUP 3 + @ ?DUP \ is there a part 2      IF SWAP DROP   \ start of part 2        ELSE @ THEN    \ start of part 1       ELSE \ first file, return end of disk    560                                    THEN ;                                                                                                                : ^DIREC \ -- ADR                         PAD FILE# @ 6 * + ;                                                                                                                                  ( FAH  )                                                                 ( !BSMFILE               <10/16/86>213) HEX                                     \ stores the first half of the          \ file                                  : !BSMFILE ( -- )                         FFE0 @ B600 U<   \ file in two parts?   IF FFEC C@       \ last page in BSM     ELSE FFE1 C@     \ last page used..     THEN             \ ..which is in BSM    100 OVER -       \ len in pages         ^DIREC 2+ C!     \ !len in direc        100 *            \ source adr           GETSEC# ^DIREC 2+ C@ -                  DUP ^DIREC !     \ sector number        0 ^DIREC 2+ C@ RWSEC# \ write it      ;                                       DECIMAL                                                                                                                                                                                                                                                                                                                                                                                         ( !FILE                  <10/16/86>214) HEX                                     : !FILE ( N -- ; 0<N<63 )                 ?NUM FILE# ! SWAP-BSM                   PAD 0C 1 1 RWSEC# \ get directory       !BSMFILE                              \ now see if there is a part 2            FFE0 @ B600 U<    \ two parts?          IF FFE1 C@        \ lowest page used     B6 OVER -        \ len in pages         ^DIREC 5 + C!    \ !len in direc        100 *            \ source adr           ^DIREC @         \ last sec part 1      ^DIREC 5 + C@ -  \ start sec #          DUP ^DIREC 3 + ! \ sector number        0 ^DIREC 5 + C@ RWSEC# \ write it      ELSE \ clear directory enrty             0 ^DIREC 3 + !                          0 ^DIREC 5 + C! THEN                   PAD 0C 0 1 RWSEC# \ write directory     SWAP-BSM 1 FILE# +! CR CR GETSEC#       ." Last sector used=" . CR CR ;       DECIMAL                                                                ( FAH  )                                                                 ( GETF                   <10/19/86>215)                                         \                                       : GETF ( n -- )                           ?NUM SWAP-BSM                           @FILE DUP 46592 U<                      IF BUFMOVE                              ELSE DROP THEN                          SWAP-BSM                              ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( FAH  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( CHEAP BUFFERS          <10/ 7/86>270)                                         : BUFFERS ( N -- )                        ?NUM FLUSH                              LIMIT HERE - 0 1028 U/MOD               SWAP DROP MIN                           DUP TO #BUFF                            1028 * LIMIT SWAP - TO FIRST            EMPTY-BUFFERS ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (                        <10/ 7/86>271)                                                                                 : MYR                                     CR CR ." SWAP-BSM (Y/N)? "              BEGIN KEY DUP                            ASCII Y = OVER ASCII N = OR NOT        WHILE DROP                              REPEAT                                  ASCII Y =                               IF SWAP-BSM THEN                        <ABORT>                               ;                                                                               ' MYR CFA ' BRK-RETN !                                                                                                                                                                                                                                                                                                                                                                                 ( FAH  )                                                                 ( @AB                    <10/13/86>272)                                         : @AB ( ADR -- N )                        DUP C@AUX-BSM                           SWAP 1+ C@AUX-BSM 256 * + ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( FAH  )                                                                 ( swappage               <10/ 7/86>148)                                         \ swap page X between aux/main BSM      \ A,Y destroyed                         HEX CODE swappage                         C009 STA,           \ aux ZP/STK/BSM    0 # LDA,                                F1 STX, F0 STA,     \ set aux zp ptr    C008 STA,           \ main ZP/STK/BSM   F1 STX, F0 STA,     \ set main zp ptr   # 0 LDY,            \ loop counter      BEGIN, C008 STA,                         F0 )Y LDA, TAX,    \ read main          C009 STA, F0 )Y LDA, \ read aux         C008 STA, F0 )Y STA, \ store main       C009 STA, TXA,                          F0 )Y STA,         \ store aux          INY, 0=                                UNTIL,                                  C008 STA,           \ main ZP/STK/BSM   F1 LDX,             \ restore X         RTS, C;                               DECIMAL                                                                ( FAH  )                                                                 ( SWAP-BSM               <10/ 7/86>149) \ SWAP main and auxillary BSM           \ destroyes 240-241 (N,N+1)  in both    \ main and auxillary memory             \ leaves with main bank 1 BSM active                                            HEX CODE SWAP-BSM                         XSAVE STX,                            \ copy bank 1 BSM                         C08B LDA, C08B LDA, \ r/w BSM bank 2    # D0 LDX,           \ starting page     BEGIN, ' swappage JSR,                   INX, # E0 CPX, 0= UNTIL,             \ copy bank 2 and remainder of BSM        C083 LDA, C083 LDA, \ r/w BSM bank 1    # D0 LDX,           \ starting page     BEGIN, ' swappage JSR,                   INX, # 00 CPX, 0= UNTIL,               XSAVE LDX,                              NEXT JMP,                             C; DECIMAL                                                                                                                                             ( FAH  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 